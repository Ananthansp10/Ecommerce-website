<div class="text-center text-medium font-bold text-green-500 mt-7">
  <p>{{message}}</p>
</div>
<div class="min-h-screen bg-white flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-md w-full space-y-8">
    <!-- Mob N Access Heading -->
    <h1 class="text-center ms-7 font-extrabold text-2xl text-indigo-600 tracking-tight">
      Mob N Access
    </h1>

    <!-- OTP Verification Section -->
    <div class="bg-gray-300 py-8 px-4 shadow sm:rounded-lg sm:px-10">
      <h2 class="text-center text-2xl font-bold leading-9 tracking-tight text-gray-900">
        Verify OTP
      </h2>
      <p class="text-center text-sm text-gray-600 mt-2">
        We have sent a code to your email. Please enter it below.
      </p>

      <!-- OTP Form -->
      <form class="space-y-6 mt-6" action="/users/signup-otp-verification" method="POST">
        <!-- OTP Input Fields -->
        <div class="flex justify-center space-x-4">
          <!-- Circular Input Fields for OTP -->
          <input type="text" name="first" maxlength="1" class="w-12 h-12 text-center text-2xl rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-600" oninput="moveToNext(this, 'second')" />
          <input type="text" name="second" maxlength="1" class="w-12 h-12 text-center text-2xl rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-600" oninput="moveToNext(this, 'third')" />
          <input type="text" name="third" maxlength="1" class="w-12 h-12 text-center text-2xl rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-600" oninput="moveToNext(this, 'fourth')" />
          <input type="text" name="fourth" maxlength="1" class="w-12 h-12 text-center text-2xl rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-600" oninput="moveToNext(this, null)" />
        </div>

        <!-- Resend OTP Option with Timer -->
        <div class="flex justify-between items-center text-sm text-gray-500 mt-4">
          <p class="text-black">Didn't receive the code?</p>

          <!-- Timer shown separately -->
          <div id="timer-container">
            <span id="timer" class="font-semibold text-indigo-600">60s</span>
          </div>

          <!-- Resend OTP Button (Initially Hidden) -->
          <button type="button" class="font-semibold text-indigo-600 hover:text-indigo-500" id="resend-button" style="display: none;">
            Resend OTP
          </button>
        </div>

        <!-- Submit Button -->
        <div>
          <button type="submit" class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Submit
          </button>
        </div>
      </form>

      <!-- Divider for Social Authentication -->
      <div class="relative mt-6">
        <div class="absolute inset-0 flex items-center">
          <div class="w-full border-t border-gray-300"></div>
        </div>
        <div class="relative flex justify-center text-sm">
          <span class="px-2 bg-white text-gray-500">
            Or continue with
          </span>
        </div>
      </div>

      <!-- Social Authentication Buttons -->
      <div class="mt-6 grid grid-cols-2 gap-4">
        <button class="w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">
          <svg class="w-5 h-5 mr-2" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M23.5 12.3c0-.8-.1-1.6-.2-2.4H12v4.8h6.5c-.3 1.7-1.4 3.1-2.9 4.1v3.4h4.6c2.7-2.5 4.3-6.1 4.3-9.9z" fill="#4285F4"></path>
            <path d="M12 24c3.2 0 5.8-1.1 7.7-3l-4.6-3.4c-1.3.9-3 1.4-4.7 1.4-3.6 0-6.7-2.4-7.8-5.8H.7v3.5C2.5 20.6 7 24 12 24z" fill="#34A853"></path>
            <path d="M4.2 14.2C3.9 13.3 3.7 12.2 3.7 11.2s.2-2.1.5-3.1V4.6H.7C-.4 6.7-1 8.9-1 11.2s.6 4.6 1.7 6.7l3.5-3.7z" fill="#FBBC05"></path>
            <path d="M12 4.8c1.6 0 3 .6 4.1 1.7l3.1-3.1C17.8 1.4 15 0 12 0 7 0 2.5 3.4.7 8.1l3.5 3.6C5.3 6.8 8.3 4.8 12 4.8z" fill="#EA4335"></path>
          </svg>
          Google
        </button>
        <button class="w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">
          <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M24 12c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 6.177 4.708 11.293 10.672 11.93v-8.422h-3.194v-3.508h3.194v-2.644c0-3.159 1.888-4.894 4.776-4.894 1.386 0 2.835.246 2.835.246v3.118h-1.596c-1.571 0-2.058 1.187-2.058 2.399v2.775h3.437l-.55 3.508h-2.887v8.422c5.964-.637 10.672-5.753 10.672-11.93z" fill="#1877F2"/>
          </svg>
          Facebook
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  // OTP button focus
  function moveToNext(currentField, nextFieldId) {
    if (currentField.value.length === currentField.maxLength) {
      if (nextFieldId) {
        setTimeout(() => {
          document.getElementById(nextFieldId).focus();
        }, 10);
      }
    }
  }

  // Timer logic for Resend OTP button
  let timeLeft = 60; // Change the starting time here
  const timerElement = document.getElementById('timer');
  const resendButton = document.getElementById('resend-button');
  
  // Hide the resend button initially
  resendButton.style.display = 'none';

  const countdown = setInterval(() => {
    if (timeLeft > 0) {
      timeLeft--;
      timerElement.innerText = `${timeLeft}s`;
    } else {
      clearInterval(countdown);
      // Show the resend button when time runs out
      resendButton.style.display = 'inline';
      timerElement.innerText = ''; // Clear the timer text
    }
  }, 1000);

  // Add click event listener to the resend button
  resendButton.addEventListener('click', () => {
    // Send request to the backend to resend OTP
    fetch('/users/resend-signup-otp', {
      method: 'POST',
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert('OTP has been resent.');
        // Optionally restart the timer if you want to prevent immediate clicks
        timeLeft = 60;  // Reset the timer
        resendButton.style.display = 'none'; // Hide the resend button again
        countdown = setInterval(() => {
          if (timeLeft > 0) {
            timeLeft--;
            timerElement.innerText = `${timeLeft}s`;
          } else {
            clearInterval(countdown);
            resendButton.style.display = 'inline';
            timerElement.innerText = '';
          }
        }, 1000);
      } else {
        alert('Error resending OTP. Please try again.');
      }
    })
    .catch(error => {
      console.error('Error:', error);
    });
  });
</script>
