<div class="container mx-auto p-8 space-y-8">
  <!-- Page Header -->
  <h1 class="text-3xl font-semibold mb-8 text-gray-700">Order Details</h1>

  <!-- Product Details Section -->
  <div class="bg-white shadow-md rounded-lg p-6">
    <h2 class="text-xl font-semibold mb-4 text-gray-700">Product Details</h2>
    <div class="divide-y divide-gray-200">
      <!-- Product Item -->
      <div class="flex items-center py-4">
        <img src="{{data.images.[0]}}" alt="Product Image" class="w-24 h-24 object-cover rounded-lg mr-4">
        <div class="flex-1">
          <h3 class="text-lg font-semibold text-gray-800">{{data.productName}}</h3>
          <p class="text-gray-500">{{data.description}}</p>
          <p class="mt-2 font-medium">Quantity: <span class="text-gray-700">{{data.quantity}}</span></p>
          <p class="mt-1 text-lg font-bold text-gray-800">Rs.{{data.price}}</p>
          <p class="mt-1 text-lg font-bold text-gray-800">Total Price : Rs.{{data.productTotal}}</p>
          <p class="mt-1 text-lg font-bold text-gray-800">Additional Amount : Rs.150 (For the entire order not for the product)</p>
          <p class="mt-1 text-md font-bold text-blue-600">Buyable Price Rs.{{data.buyablePrice}}</p>
          <p class="mt-1 text-lg font-bold text-gray-800">Product Status : {{data.orderStatus}}</p>
          <p class="mt-1 text-lg font-bold text-gray-800">Payment Method : {{data.paymentMethod}}</p>
          <p class="mt-1 text-lg font-bold text-red-600">Coupon Used : {{data.couponCode}}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Shipping Address Section -->
  <div class="bg-white shadow-md rounded-lg p-6">
    <h2 class="text-xl font-semibold mb-4 text-gray-700">Shipping Address</h2>
    <div class="text-gray-600">
      <p><strong>Address Type:</strong> {{address.addressType}}</p>
      <p><strong>AddressLine1:</strong> {{address.addressLine1}}</p>
      <p><strong>AddressLine2:</strong> {{address.addressLine2}}</p>
      <p><strong>City:</strong> {{address.city}}</p>
      <p><strong>State:</strong> {{address.state}}</p>
      <p><strong>Country:</strong> {{address.country}}</p>
      <p><strong>Pincode:</strong> {{address.pincode}}</p>
      <p><strong>Landmark:</strong> {{address.landmark}}</p>
    </div>
  </div>

  <!-- Order Tracking Section -->
  <div class="bg-white shadow-md rounded-lg p-6">
    <h2 class="text-xl font-semibold mb-4 text-gray-700">Order Tracking</h2>

    <!-- Tracking Steps -->
    {{#if trackDetails.isPlaced}}
    <div class="flex items-center space-x-4 mb-6">
      <div class="flex items-center">
        <div class="w-8 h-8 flex items-center justify-center bg-blue-600 text-white font-semibold rounded-full">1</div>
        <span class="ml-2 text-gray-700">Order Placed</span>
      </div>
      <div class="h-0.5 bg-blue-600 flex-1"></div>
      
      <div class="flex items-center">
        <div class="w-8 h-8 flex items-center justify-center bg-gray-300 text-gray-500 font-semibold rounded-full">2</div>
        <span class="ml-2 text-gray-700">Shipped</span>
      </div>
      <div class="h-0.5  bg-gray-300 flex-1"></div>

      <div class="flex items-center">
        <div class="w-8 h-8 flex items-center justify-center  bg-gray-300 text-gray-500 font-semibold rounded-full">3</div>
        <span class="ml-2 text-gray-700">Out for Delivery</span>
      </div>
      <div class="h-0.5 bg-gray-300 flex-1"></div>

      <div class="flex items-center">
        <div class="w-8 h-8 flex items-center justify-center bg-gray-300 text-gray-500 font-semibold rounded-full">4</div>
        <span class="ml-2 text-gray-500">Delivered</span>
      </div>
    </div>
    {{/if}}
    {{#if trackDetails.isShipped}}
    <div class="flex items-center space-x-4 mb-6">
      <div class="flex items-center">
        <div class="w-8 h-8 flex items-center justify-center bg-blue-600 text-white font-semibold rounded-full">1</div>
        <span class="ml-2 text-gray-700">Order Placed</span>
      </div>
      <div class="h-0.5 bg-blue-600 flex-1"></div>
      
      <div class="flex items-center">
        <div class="w-8 h-8 flex items-center justify-center bg-blue-600 text-white font-semibold rounded-full">2</div>
        <span class="ml-2 text-gray-700">Shipped</span>
      </div>
      <div class="h-0.5 bg-blue-600 flex-1"></div>

      <div class="flex items-center">
        <div class="w-8 h-8 flex items-center justify-center  bg-gray-300 text-gray-500 font-semibold rounded-full">3</div>
        <span class="ml-2 text-gray-700">Out for Delivery</span>
      </div>
      <div class="h-0.5 bg-gray-300 flex-1"></div>

      <div class="flex items-center">
        <div class="w-8 h-8 flex items-center justify-center bg-gray-300 text-gray-500 font-semibold rounded-full">4</div>
        <span class="ml-2 text-gray-500">Delivered</span>
      </div>
    </div>
    {{/if}}
    {{#if trackDetails.isOutForDelivery}}
    <div class="flex items-center space-x-4 mb-6">
      <div class="flex items-center">
        <div class="w-8 h-8 flex items-center justify-center bg-blue-600 text-white font-semibold rounded-full">1</div>
        <span class="ml-2 text-gray-700">Order Placed</span>
      </div>
      <div class="h-0.5 bg-blue-600 flex-1"></div>
      
      <div class="flex items-center">
        <div class="w-8 h-8 flex items-center justify-center bg-blue-600 text-white font-semibold rounded-full">2</div>
        <span class="ml-2 text-gray-700">Shipped</span>
      </div>
      <div class="h-0.5 bg-blue-600 flex-1"></div>

      <div class="flex items-center">
        <div class="w-8 h-8 flex items-center justify-center bg-blue-600 text-white font-semibold rounded-full">3</div>
        <span class="ml-2 text-gray-700">Out for Delivery</span>
      </div>
      <div class="h-0.5 bg-blue-600 flex-1"></div>

      <div class="flex items-center">
        <div class="w-8 h-8 flex items-center justify-center bg-gray-300 text-gray-500 font-semibold rounded-full">4</div>
        <span class="ml-2 text-gray-500">Delivered</span>
      </div>
    </div>
    {{/if}}
    {{#if trackDetails.isDelivered}}
    <div class="flex items-center space-x-4 mb-6">
      <div class="flex items-center">
        <div class="w-8 h-8 flex items-center justify-center bg-blue-600 text-white font-semibold rounded-full">1</div>
        <span class="ml-2 text-gray-700">Order Placed</span>
      </div>
      <div class="h-0.5 bg-blue-600 flex-1"></div>
      
      <div class="flex items-center">
        <div class="w-8 h-8 flex items-center justify-center bg-blue-600 text-white font-semibold rounded-full">2</div>
        <span class="ml-2 text-gray-700">Shipped</span>
      </div>
      <div class="h-0.5 bg-blue-600 flex-1"></div>

      <div class="flex items-center">
        <div class="w-8 h-8 flex items-center justify-center bg-blue-600 text-white font-semibold rounded-full">3</div>
        <span class="ml-2 text-gray-700">Out for Delivery</span>
      </div>
      <div class="h-0.5 bg-blue-600 flex-1"></div>

      <div class="flex items-center">
        <div class="w-8 h-8 flex items-center justify-center bg-blue-600 text-white font-semibold rounded-full">4</div>
        <span class="ml-2 text-gray-500">Delivered</span>
      </div>
    </div>
    {{/if}}

    <!-- Tracking Dates -->
    <div class="space-y-4 text-gray-600">
      <div class="flex justify-between">
        <p>Order Placed</p>
        <p>{{trackDetails.date}}</p>
      </div>
      <div class="flex justify-between">
        <p>Shipped</p>
        <p>{{#if trackDetails.shippedDate}}{{trackDetails.shippedDate}}{{else}}Not yet Shipped{{/if}}</p>
      </div>
      <div class="flex justify-between">
        <p>Out for Delivery</p>
        <p>{{#if trackDetails.arrivedDate}}{{trackDetails.arrivedDate}}{{else}}Not yet Arrived{{/if}}</p>
      </div>
      <div class="flex justify-between text-gray-600">
        <p>Delivered</p>
        <p>{{#if trackDetails.deliveredDate}}{{trackDetails.deliveredDate}}{{else}}Expected {{trackDetails.expectedDate}}{{/if}}</p>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="flex justify-end space-x-4">
    <button onclick="cancelOrder('{{data.productId}}','{{orderId}}',{{data.quantity}})" class="px-6 py-2 bg-red-600 text-white font-medium rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-75">
      Cancel Order
    </button>
    <button onclick="downloadInvoice()" class="px-6 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-opacity-75">
     Print Invoice
    </button>
    <button class="px-6 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75">
      Contact Support
    </button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>

<script>
  function cancelOrder(productId,orderId,quantity) {
  Swal.fire({
    title: 'Are you sure?',
    text: "Do you want to cancel this order?",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Yes, cancel it!'
  }).then((result) => {
    if (result.isConfirmed) {
      fetch(`/users/cartordercancel/${productId}/${orderId}/${quantity}`, {
        method: "POST"
      }).then((response) => {
        if (response.status){
          Swal.fire(
            'Cancelled!',
            'Your order has been cancelled.',
            'success'
          ).then(() => {
            location.href='/users/orders';
          });
        } else {
          Swal.fire(
            'Error!',
            'Product could not be removed.',
            'error'
          ).then(()=>{
            location.reload();
          })
        }
      }).catch((error) => {
        Swal.fire(
          'Error!',
          'There was an error processing your request.',
          'error'
        );
      });
    }
  });
}

  async function downloadInvoice() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    doc.setTextColor(0, 102, 204);
    doc.setFontSize(18);
    doc.text("MOB N ACCESS", 105, 20, { align: "center" }); 
    
    doc.setTextColor(255, 87, 34);
    doc.setFontSize(18);
    doc.text("Invoice", 105, 40, { align: "center" });
    
    doc.setTextColor(0, 0, 0);
    doc.setFontSize(12);
    doc.text(`Order ID: {{orderId}}`, 10, 60);
    doc.text(`Order Date: {{trackDetails.date}}`, 10, 70);

    const productImageUrl = "{{data.images.[0]}}";
    if (productImageUrl) {
        try {
            doc.addImage(productImageUrl, 'JPEG', 130, 40, 50, 50);
        } catch (error) {
            console.error("Error adding image to PDF:", error);
        }
    } else {
        console.log("No image found");
    }

    doc.setFontSize(14);
    doc.text("Product Details:", 10, 80);
    doc.setFontSize(12);
    doc.text(`Name: {{data.productName}}`, 10, 90);
    doc.text(`Description: {{data.description}}`,10,100)
    doc.text(`Quantity: {{data.quantity}}`, 10, 130);
    doc.text(`Price: Rs. {{data.price}}`, 10, 140);
    doc.text(`Total Price: Rs. {{data.productTotal}}`, 10, 150);
    doc.text(`Buyable Price: Rs. {{data.buyablePrice}}`, 10, 160);
    doc.text(`Order Status: {{data.orderStatus}}`, 10, 170);
    doc.text(`Payment Method: {{data.paymentMethod}}`, 10, 180);
    doc.text(`Coupon Code: {{data.couponCode}}`, 10, 190);

    doc.setFontSize(14);
    doc.text("Shipping Address:", 10, 210);
    doc.setFontSize(12);
    doc.text(`Type: {{address.addressType}}`, 10, 220);
    doc.text(`Address Line 1: {{address.addressLine1}}`, 10, 230);
    doc.text(`Address Line 2: {{address.addressLine2}}`, 10, 240);
    doc.text(`City: {{address.city}}`, 10, 250);
    doc.text(`State: {{address.state}}`, 10, 260);
    doc.text(`Country: {{address.country}}`, 10, 270);
    doc.text(`Pincode: {{address.pincode}}`, 10, 280);
    doc.text(`Landmark: {{address.landmark}}`, 10, 290);

    doc.save(`Invoice_Order_{{orderId}}.pdf`);
  }
</script>
